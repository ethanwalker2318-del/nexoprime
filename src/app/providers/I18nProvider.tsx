import { createContext, useCallback, useContext, useMemo, useState, type PropsWithChildren } from "react";
import { useTelegram } from "./TelegramProvider";

type Dictionary = Record<string, string>;

export type Locale = "ru" | "en" | "de";

interface I18nContextValue {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string) => string;
}

const LOCALE_STORAGE_KEY = "nexosite.locale";

const ru: Dictionary = {
  "app.name": "NexoSite Prime",
  "common.language.ru": "Русский",
  "common.language.en": "English",
  "common.language.de": "Deutsch",
  "common.country.de": "Германия",
  "common.country.ae": "ОАЭ",
  "common.country.sg": "Сингапур",
  "common.country.gb": "Великобритания",
  "common.country.ch": "Швейцария",
  "common.live": "Live",
  "onboarding.badge": "Институциональный доступ",
  "onboarding.title": "Завершите быструю регистрацию",
  "onboarding.subtitle": "Мы настраиваем безопасный доступ и персонализируем интерфейс для вашего региона.",
  "onboarding.step.one": "Шаг 1 из 3",
  "onboarding.step.two": "Шаг 2 из 3",
  "onboarding.step.three": "Шаг 3 из 3",
  "onboarding.email.label": "Email",
  "onboarding.email.placeholder": "name@company.com",
  "onboarding.code.label": "Код подтверждения",
  "onboarding.code.placeholder": "Введите 6-значный код",
  "onboarding.language.label": "Язык интерфейса",
  "onboarding.country.label": "Страна",
  "onboarding.note": "Код подтверждения моковый. Введите любые 6 цифр для продолжения.",
  "onboarding.continue": "Продолжить",
  "onboarding.verify": "Подтвердить код",
  "onboarding.enter": "Войти в Dashboard",
  "dashboard.header.greeting": "Добро пожаловать",
  "dashboard.header.updated": "Обновлено 12 сек назад",
  "dashboard.menu.security": "Центр безопасности",
  "dashboard.menu.settings": "Настройки",
  "dashboard.menu.support": "Поддержка",
  "dashboard.menu.logout": "Выйти",
  "dashboard.balance.title": "Общий баланс",
  "dashboard.balance.subtitle": "Оценка портфеля в USD",
  "dashboard.balance.available": "Доступно",
  "dashboard.balance.reserved": "В ордерах",
  "dashboard.actions.deposit": "Пополнить",
  "dashboard.actions.withdraw": "Вывести",
  "dashboard.actions.exchange": "Обменять",
  "dashboard.profile.title": "Профиль",
  "dashboard.profile.id": "ID",
  "dashboard.profile.email": "Email",
  "dashboard.profile.country": "Страна",
  "dashboard.profile.language": "Язык",
  "dashboard.profile.registered": "Дата регистрации",
  "dashboard.assets.title": "Криптоактивы",
  "dashboard.assets.price": "Цена",
  "dashboard.assets.change": "24ч",
  "dashboard.assets.balance": "Баланс",
  "dashboard.reviews.title": "Отзывы клиентов",
  "dashboard.analytics.title": "Аналитика",
  "dashboard.analytics.caption": "Статистика за 30 дней",
  "dashboard.analytics.winRate": "Win Rate",
  "dashboard.analytics.avgProfit": "Средняя прибыль",
  "dashboard.analytics.avgLoss": "Средний убыток",
  "dashboard.analytics.profitFactor": "Profit Factor",
  "nav.home": "Главная",
  "nav.trade": "Торговля",
  "nav.wallet": "Кошелёк",
  "nav.analytics": "Аналитика",
  "nav.profile": "Профиль",
  "wallet.title": "Кошелёк",
  "wallet.subtitle": "Пополнение, вывод, обмен",
  "wallet.tab.deposit": "Депозит",
  "wallet.tab.withdraw": "Вывод",
  "wallet.tab.exchange": "Обмен",
  "wallet.tab.history": "История",
  "wallet.deposit.network": "Выберите сеть",
  "wallet.deposit.fee": "Комиссия:",
  "wallet.deposit.confirmations": "подтв.",
  "wallet.deposit.address": "Адрес для пополнения",
  "wallet.deposit.copy": "Копировать",
  "wallet.deposit.copied": "Скопировано",
  "wallet.deposit.warning": "Отправляйте только USDT в выбранной сети. Другие активы будут безвозвратно утеряны.",
  "wallet.deposit.minAmount": "Минимум",
  "wallet.withdraw.asset": "Актив для вывода",
  "wallet.withdraw.address": "Адрес получателя",
  "wallet.withdraw.amount": "Сумма",
  "wallet.withdraw.networkFee": "Сетевая комиссия",
  "wallet.withdraw.processing": "Время обработки",
  "wallet.withdraw.submit": "Вывести средства",
  "wallet.withdraw.success.title": "Заявка отправлена",
  "wallet.withdraw.success.subtitle": "Ваша заявка на вывод обрабатывается. Ожидайте подтверждения.",
  "wallet.withdraw.success.new": "Новая заявка",
  "wallet.exchange.from": "Отдаёте",
  "wallet.exchange.to": "Получаете",
  "wallet.exchange.estimated": "Ориентировочно",
  "wallet.exchange.rate": "Курс",
  "wallet.exchange.fee": "Комиссия платформы",
  "wallet.exchange.submit": "Обменять",
  "wallet.history.filter.all": "Все",
  "wallet.history.filter.deposit": "Депозит",
  "wallet.history.filter.withdraw": "Вывод",
  "wallet.history.filter.exchange": "Обмен",
  "wallet.history.empty": "Операций не найдено",
  "wallet.history.type.deposit": "Пополнение",
  "wallet.history.type.withdraw": "Вывод",
  "wallet.history.type.exchange": "Обмен",
  "wallet.history.status.completed": "Завершено",
  "wallet.history.status.pending": "В обработке",
  "wallet.history.status.failed": "Ошибка",
  "trade.title": "Торговля",
  "trade.subtitle": "Рыночные данные и управление позициями",
  "trade.tab.market": "Рынок",
  "trade.tab.portfolio": "Портфель",
  "trade.market.asset": "Актив",
  "trade.market.price": "Цена",
  "trade.market.volume": "Объём",
  "trade.market.change": "24ч",
  "trade.orderbook.title": "Стакан ордеров",
  "trade.orderbook.bids": "Покупка",
  "trade.orderbook.asks": "Продажа",
  "trade.order.buy": "Купить",
  "trade.order.sell": "Продать",
  "trade.order.amount": "Количество",
  "trade.order.total": "Итого",
  "trade.portfolio.avgPrice": "Ср. цена",
  "trade.portfolio.currentPrice": "Тек. цена",
  "analytics.title": "Аналитика P&L",
  "analytics.subtitle": "Результаты торговли и метрики риска",
  "analytics.pnl.total": "Прибыль/убыток",
  "analytics.pnl.breakdown": "Разбивка по периодам",
  "analytics.metrics.title": "Ключевые показатели",
  "analytics.risk.title": "Метрики риска",
  "analytics.trades.best": "Лучшие сделки",
  "analytics.trades.worst": "Худшие сделки",
  "profile.nav.account": "Аккаунт",
  "profile.nav.security": "Безопасность",
  "profile.nav.settings": "Настройки",
  "profile.nav.support": "Поддержка",
  "profile.status.verified": "Верифицирован",
  "profile.account.identity": "Данные аккаунта",
  "profile.account.kyc": "Верификация KYC",
  "profile.account.kyc.title": "KYC подтверждён",
  "profile.account.kyc.desc": "Уровень 2 · Все документы проверены",
  "profile.account.dailyLimit": "Лимит/день",
  "profile.account.monthlyLimit": "Лимит/месяц",
  "profile.account.logoutConfirm": "Вы уверены, что хотите выйти?",
  "profile.account.cancel": "Отмена",
  "profile.security.title": "Защита аккаунта",
  "profile.security.2fa": "Двухфакторная аутентификация",
  "profile.security.2faDesc": "Google Authenticator · 6-значный TOTP",
  "profile.security.antiPhishing": "Антифишинговый код",
  "profile.security.antiPhishingDesc": "Проверяйте этот код в каждом письме от NEXO Prime",
  "profile.security.sessions": "Активные сессии",
  "profile.security.current": "Текущая",
  "profile.security.revoke": "Завершить",
  "profile.security.notifications": "Уведомления безопасности",
  "profile.security.notif.login": "Новый вход в систему",
  "profile.security.notif.withdrawal": "Заявка на вывод",
  "profile.security.notif.large": "Крупные операции (>$10K)",
  "profile.security.on": "Вкл",
  "profile.security.off": "Выкл",
  "profile.settings.appearance": "Внешний вид",
  "profile.settings.theme": "Тема оформления",
  "profile.settings.themeDark": "Premium Dark Institutional",
  "profile.settings.themeActive": "Активна",
  "profile.settings.data": "Данные",
  "profile.settings.exportHistory": "Экспорт истории операций (CSV)",
  "profile.settings.deleteAccount": "Удалить аккаунт",
  "profile.support.faq": "Центр помощи",
  "profile.support.faqDesc": "Ответы на частые вопросы",
  "profile.support.chat": "Живой чат",
  "profile.support.chatDesc": "Поддержка 24/7 на русском языке",
  "profile.support.status": "Статус системы",
  "profile.support.statusDesc": "Текущее состояние сервисов",
  "profile.support.feedback": "Обратная связь",
  "profile.support.feedbackDesc": "Напишите нам по любому вопросу",
  "profile.support.systemStatus": "Статус сервисов",
  "profile.support.operational": "Работает",
  "profile.support.degraded": "Сбой",
  "profile.support.uptime": "Uptime"
};

const en: Dictionary = {
  "app.name": "NexoSite Prime",
  "common.language.ru": "Russian",
  "common.language.en": "English",
  "common.language.de": "German",
  "common.country.de": "Germany",
  "common.country.ae": "United Arab Emirates",
  "common.country.sg": "Singapore",
  "common.country.gb": "United Kingdom",
  "common.country.ch": "Switzerland",
  "common.live": "Live",
  "onboarding.badge": "Institutional Access",
  "onboarding.title": "Complete quick registration",
  "onboarding.subtitle": "We configure secure access and personalize the workspace for your region.",
  "onboarding.step.one": "Step 1 of 3",
  "onboarding.step.two": "Step 2 of 3",
  "onboarding.step.three": "Step 3 of 3",
  "onboarding.email.label": "Email",
  "onboarding.email.placeholder": "name@company.com",
  "onboarding.code.label": "Verification code",
  "onboarding.code.placeholder": "Enter 6-digit code",
  "onboarding.language.label": "Interface language",
  "onboarding.country.label": "Country",
  "onboarding.note": "Verification is mocked. Enter any 6 digits to continue.",
  "onboarding.continue": "Continue",
  "onboarding.verify": "Verify code",
  "onboarding.enter": "Enter Dashboard",
  "dashboard.header.greeting": "Welcome back",
  "dashboard.header.updated": "Updated 12 sec ago",
  "dashboard.menu.security": "Security Center",
  "dashboard.menu.settings": "Settings",
  "dashboard.menu.support": "Support",
  "dashboard.menu.logout": "Log out",
  "dashboard.balance.title": "Total balance",
  "dashboard.balance.subtitle": "Portfolio valuation in USD",
  "dashboard.balance.available": "Available",
  "dashboard.balance.reserved": "In orders",
  "dashboard.actions.deposit": "Deposit",
  "dashboard.actions.withdraw": "Withdraw",
  "dashboard.actions.exchange": "Exchange",
  "dashboard.profile.title": "Profile",
  "dashboard.profile.id": "ID",
  "dashboard.profile.email": "Email",
  "dashboard.profile.country": "Country",
  "dashboard.profile.language": "Language",
  "dashboard.profile.registered": "Registered",
  "dashboard.assets.title": "Crypto assets",
  "dashboard.assets.price": "Price",
  "dashboard.assets.change": "24h",
  "dashboard.assets.balance": "Balance",
  "dashboard.reviews.title": "Client reviews",
  "dashboard.analytics.title": "Analytics",
  "dashboard.analytics.caption": "30-day trading stats",
  "dashboard.analytics.winRate": "Win Rate",
  "dashboard.analytics.avgProfit": "Avg. Profit",
  "dashboard.analytics.avgLoss": "Avg. Loss",
  "dashboard.analytics.profitFactor": "Profit Factor",
  "nav.home": "Home",
  "nav.trade": "Trade",
  "nav.wallet": "Wallet",
  "nav.analytics": "Analytics",
  "nav.profile": "Profile",
  "wallet.title": "Wallet",
  "wallet.subtitle": "Deposit, withdraw & exchange",
  "wallet.tab.deposit": "Deposit",
  "wallet.tab.withdraw": "Withdraw",
  "wallet.tab.exchange": "Exchange",
  "wallet.tab.history": "History",
  "wallet.deposit.network": "Select network",
  "wallet.deposit.fee": "Fee:",
  "wallet.deposit.confirmations": "conf.",
  "wallet.deposit.address": "Deposit address",
  "wallet.deposit.copy": "Copy",
  "wallet.deposit.copied": "Copied",
  "wallet.deposit.warning": "Only send USDT on the selected network. Other assets will be permanently lost.",
  "wallet.deposit.minAmount": "Minimum",
  "wallet.withdraw.asset": "Asset to withdraw",
  "wallet.withdraw.address": "Recipient address",
  "wallet.withdraw.amount": "Amount",
  "wallet.withdraw.networkFee": "Network fee",
  "wallet.withdraw.processing": "Processing time",
  "wallet.withdraw.submit": "Withdraw funds",
  "wallet.withdraw.success.title": "Request submitted",
  "wallet.withdraw.success.subtitle": "Your withdrawal request is being processed. Please await confirmation.",
  "wallet.withdraw.success.new": "New request",
  "wallet.exchange.from": "You send",
  "wallet.exchange.to": "You receive",
  "wallet.exchange.estimated": "Estimated",
  "wallet.exchange.rate": "Rate",
  "wallet.exchange.fee": "Platform fee",
  "wallet.exchange.submit": "Exchange",
  "wallet.history.filter.all": "All",
  "wallet.history.filter.deposit": "Deposit",
  "wallet.history.filter.withdraw": "Withdraw",
  "wallet.history.filter.exchange": "Exchange",
  "wallet.history.empty": "No transactions found",
  "wallet.history.type.deposit": "Deposit",
  "wallet.history.type.withdraw": "Withdrawal",
  "wallet.history.type.exchange": "Exchange",
  "wallet.history.status.completed": "Completed",
  "wallet.history.status.pending": "Pending",
  "wallet.history.status.failed": "Failed",
  "trade.title": "Trade",
  "trade.subtitle": "Market data and position management",
  "trade.tab.market": "Market",
  "trade.tab.portfolio": "Portfolio",
  "trade.market.asset": "Asset",
  "trade.market.price": "Price",
  "trade.market.volume": "Volume",
  "trade.market.change": "24h",
  "trade.orderbook.title": "Order book",
  "trade.orderbook.bids": "Bids",
  "trade.orderbook.asks": "Asks",
  "trade.order.buy": "Buy",
  "trade.order.sell": "Sell",
  "trade.order.amount": "Amount",
  "trade.order.total": "Total",
  "trade.portfolio.avgPrice": "Avg price",
  "trade.portfolio.currentPrice": "Current price",
  "analytics.title": "P&L Analytics",
  "analytics.subtitle": "Trading performance and risk metrics",
  "analytics.pnl.total": "Profit / Loss",
  "analytics.pnl.breakdown": "Period breakdown",
  "analytics.metrics.title": "Key metrics",
  "analytics.risk.title": "Risk metrics",
  "analytics.trades.best": "Best trades",
  "analytics.trades.worst": "Worst trades",
  "profile.nav.account": "Account",
  "profile.nav.security": "Security",
  "profile.nav.settings": "Settings",
  "profile.nav.support": "Support",
  "profile.status.verified": "Verified",
  "profile.account.identity": "Account details",
  "profile.account.kyc": "KYC Verification",
  "profile.account.kyc.title": "KYC confirmed",
  "profile.account.kyc.desc": "Level 2 · All documents verified",
  "profile.account.dailyLimit": "Daily limit",
  "profile.account.monthlyLimit": "Monthly limit",
  "profile.account.logoutConfirm": "Are you sure you want to log out?",
  "profile.account.cancel": "Cancel",
  "profile.security.title": "Account protection",
  "profile.security.2fa": "Two-factor authentication",
  "profile.security.2faDesc": "Google Authenticator · 6-digit TOTP",
  "profile.security.antiPhishing": "Anti-phishing code",
  "profile.security.antiPhishingDesc": "Verify this code in every email from NEXO Prime",
  "profile.security.sessions": "Active sessions",
  "profile.security.current": "Current",
  "profile.security.revoke": "Revoke",
  "profile.security.notifications": "Security notifications",
  "profile.security.notif.login": "New login detected",
  "profile.security.notif.withdrawal": "Withdrawal request",
  "profile.security.notif.large": "Large transactions (>$10K)",
  "profile.security.on": "On",
  "profile.security.off": "Off",
  "profile.settings.appearance": "Appearance",
  "profile.settings.theme": "Color theme",
  "profile.settings.themeDark": "Premium Dark Institutional",
  "profile.settings.themeActive": "Active",
  "profile.settings.data": "Data",
  "profile.settings.exportHistory": "Export transaction history (CSV)",
  "profile.settings.deleteAccount": "Delete account",
  "profile.support.faq": "Help Center",
  "profile.support.faqDesc": "Answers to common questions",
  "profile.support.chat": "Live chat",
  "profile.support.chatDesc": "24/7 support in your language",
  "profile.support.status": "System status",
  "profile.support.statusDesc": "Current service status",
  "profile.support.feedback": "Feedback",
  "profile.support.feedbackDesc": "Contact us with any questions",
  "profile.support.systemStatus": "Service status",
  "profile.support.operational": "Operational",
  "profile.support.degraded": "Degraded",
  "profile.support.uptime": "Uptime"
};

const de: Dictionary = {
  "app.name": "NexoSite Prime",
  "common.language.ru": "Russisch",
  "common.language.en": "Englisch",
  "common.language.de": "Deutsch",
  "common.country.de": "Deutschland",
  "common.country.ae": "VAE",
  "common.country.sg": "Singapur",
  "common.country.gb": "Vereinigtes Königreich",
  "common.country.ch": "Schweiz",
  "common.live": "Live",
  "onboarding.badge": "Institutioneller Zugang",
  "onboarding.title": "Schnelle Registrierung abschließen",
  "onboarding.subtitle": "Wir konfigurieren sicheren Zugang und personalisieren die Oberfläche für Ihre Region.",
  "onboarding.step.one": "Schritt 1 von 3",
  "onboarding.step.two": "Schritt 2 von 3",
  "onboarding.step.three": "Schritt 3 von 3",
  "onboarding.email.label": "E-Mail",
  "onboarding.email.placeholder": "name@company.com",
  "onboarding.code.label": "Bestätigungscode",
  "onboarding.code.placeholder": "6-stelligen Code eingeben",
  "onboarding.language.label": "Sprache",
  "onboarding.country.label": "Land",
  "onboarding.note": "Die Verifizierung ist ein Mock. Beliebige 6 Ziffern eingeben.",
  "onboarding.continue": "Weiter",
  "onboarding.verify": "Code bestätigen",
  "onboarding.enter": "Zum Dashboard",
  "dashboard.header.greeting": "Willkommen zurück",
  "dashboard.header.updated": "Vor 12 Sek. aktualisiert",
  "dashboard.menu.security": "Sicherheitscenter",
  "dashboard.menu.settings": "Einstellungen",
  "dashboard.menu.support": "Support",
  "dashboard.menu.logout": "Abmelden",
  "dashboard.balance.title": "Gesamtguthaben",
  "dashboard.balance.subtitle": "Portfolio-Bewertung in USD",
  "dashboard.balance.available": "Verfügbar",
  "dashboard.balance.reserved": "In Orders",
  "dashboard.actions.deposit": "Einzahlen",
  "dashboard.actions.withdraw": "Auszahlen",
  "dashboard.actions.exchange": "Tauschen",
  "dashboard.profile.title": "Profil",
  "dashboard.profile.id": "ID",
  "dashboard.profile.email": "E-Mail",
  "dashboard.profile.country": "Land",
  "dashboard.profile.language": "Sprache",
  "dashboard.profile.registered": "Registriert",
  "dashboard.assets.title": "Krypto-Assets",
  "dashboard.assets.price": "Preis",
  "dashboard.assets.change": "24h",
  "dashboard.assets.balance": "Bestand",
  "dashboard.reviews.title": "Kundenbewertungen",
  "dashboard.analytics.title": "Analytik",
  "dashboard.analytics.caption": "30-Tage Trading-Statistik",
  "dashboard.analytics.winRate": "Win Rate",
  "dashboard.analytics.avgProfit": "Ø Gewinn",
  "dashboard.analytics.avgLoss": "Ø Verlust",
  "dashboard.analytics.profitFactor": "Profit Factor",
  "nav.home": "Start",
  "nav.trade": "Handel",
  "nav.wallet": "Wallet",
  "nav.analytics": "Analytik",
  "nav.profile": "Profil",
  "wallet.title": "Wallet",
  "wallet.subtitle": "Einzahlung, Auszahlung & Tausch",
  "wallet.tab.deposit": "Einzahlung",
  "wallet.tab.withdraw": "Auszahlung",
  "wallet.tab.exchange": "Tausch",
  "wallet.tab.history": "Verlauf",
  "wallet.deposit.network": "Netzwerk wählen",
  "wallet.deposit.fee": "Gebühr:",
  "wallet.deposit.confirmations": "Best.",
  "wallet.deposit.address": "Einzahlungsadresse",
  "wallet.deposit.copy": "Kopieren",
  "wallet.deposit.copied": "Kopiert",
  "wallet.deposit.warning": "Nur USDT im gewählten Netzwerk senden. Andere Assets gehen unwiderruflich verloren.",
  "wallet.deposit.minAmount": "Minimum",
  "wallet.withdraw.asset": "Auszuzahlendes Asset",
  "wallet.withdraw.address": "Empfängeradresse",
  "wallet.withdraw.amount": "Betrag",
  "wallet.withdraw.networkFee": "Netzwerkgebühr",
  "wallet.withdraw.processing": "Bearbeitungszeit",
  "wallet.withdraw.submit": "Auszahlen",
  "wallet.withdraw.success.title": "Antrag eingereicht",
  "wallet.withdraw.success.subtitle": "Ihr Auszahlungsantrag wird bearbeitet. Bitte warten Sie auf die Bestätigung.",
  "wallet.withdraw.success.new": "Neuer Antrag",
  "wallet.exchange.from": "Sie senden",
  "wallet.exchange.to": "Sie erhalten",
  "wallet.exchange.estimated": "Geschätzt",
  "wallet.exchange.rate": "Kurs",
  "wallet.exchange.fee": "Plattformgebühr",
  "wallet.exchange.submit": "Tauschen",
  "wallet.history.filter.all": "Alle",
  "wallet.history.filter.deposit": "Einzahlung",
  "wallet.history.filter.withdraw": "Auszahlung",
  "wallet.history.filter.exchange": "Tausch",
  "wallet.history.empty": "Keine Transaktionen gefunden",
  "wallet.history.type.deposit": "Einzahlung",
  "wallet.history.type.withdraw": "Auszahlung",
  "wallet.history.type.exchange": "Tausch",
  "wallet.history.status.completed": "Abgeschlossen",
  "wallet.history.status.pending": "Ausstehend",
  "wallet.history.status.failed": "Fehlgeschlagen",
  "trade.title": "Handel",
  "trade.subtitle": "Marktdaten und Positionsverwaltung",
  "trade.tab.market": "Markt",
  "trade.tab.portfolio": "Portfolio",
  "trade.market.asset": "Asset",
  "trade.market.price": "Preis",
  "trade.market.volume": "Volumen",
  "trade.market.change": "24h",
  "trade.orderbook.title": "Orderbuch",
  "trade.orderbook.bids": "Kauf",
  "trade.orderbook.asks": "Verkauf",
  "trade.order.buy": "Kaufen",
  "trade.order.sell": "Verkaufen",
  "trade.order.amount": "Menge",
  "trade.order.total": "Gesamt",
  "trade.portfolio.avgPrice": "Ø Preis",
  "trade.portfolio.currentPrice": "Akt. Preis",
  "analytics.title": "P&L Analytik",
  "analytics.subtitle": "Handelsperformance und Risikometriken",
  "analytics.pnl.total": "Gewinn / Verlust",
  "analytics.pnl.breakdown": "Aufschlüsselung",
  "analytics.metrics.title": "Kennzahlen",
  "analytics.risk.title": "Risikometriken",
  "analytics.trades.best": "Beste Trades",
  "analytics.trades.worst": "Schlechteste Trades",
  "profile.nav.account": "Konto",
  "profile.nav.security": "Sicherheit",
  "profile.nav.settings": "Einstellungen",
  "profile.nav.support": "Support",
  "profile.status.verified": "Verifiziert",
  "profile.account.identity": "Kontodetails",
  "profile.account.kyc": "KYC-Verifizierung",
  "profile.account.kyc.title": "KYC bestätigt",
  "profile.account.kyc.desc": "Stufe 2 · Alle Dokumente geprüft",
  "profile.account.dailyLimit": "Tageslimit",
  "profile.account.monthlyLimit": "Monatslimit",
  "profile.account.logoutConfirm": "Möchten Sie sich wirklich abmelden?",
  "profile.account.cancel": "Abbrechen",
  "profile.security.title": "Kontoschutz",
  "profile.security.2fa": "Zwei-Faktor-Authentifizierung",
  "profile.security.2faDesc": "Google Authenticator · 6-stelliges TOTP",
  "profile.security.antiPhishing": "Anti-Phishing-Code",
  "profile.security.antiPhishingDesc": "Prüfen Sie diesen Code in jeder E-Mail von NEXO Prime",
  "profile.security.sessions": "Aktive Sitzungen",
  "profile.security.current": "Aktuell",
  "profile.security.revoke": "Beenden",
  "profile.security.notifications": "Sicherheitsbenachrichtigungen",
  "profile.security.notif.login": "Neue Anmeldung",
  "profile.security.notif.withdrawal": "Auszahlungsantrag",
  "profile.security.notif.large": "Große Transaktionen (>10K$)",
  "profile.security.on": "Ein",
  "profile.security.off": "Aus",
  "profile.settings.appearance": "Erscheinungsbild",
  "profile.settings.theme": "Farbthema",
  "profile.settings.themeDark": "Premium Dark Institutional",
  "profile.settings.themeActive": "Aktiv",
  "profile.settings.data": "Daten",
  "profile.settings.exportHistory": "Transaktionsverlauf exportieren (CSV)",
  "profile.settings.deleteAccount": "Konto löschen",
  "profile.support.faq": "Hilfecenter",
  "profile.support.faqDesc": "Antworten auf häufige Fragen",
  "profile.support.chat": "Live-Chat",
  "profile.support.chatDesc": "24/7 Support in Ihrer Sprache",
  "profile.support.status": "Systemstatus",
  "profile.support.statusDesc": "Aktueller Dienststatus",
  "profile.support.feedback": "Feedback",
  "profile.support.feedbackDesc": "Kontaktieren Sie uns bei Fragen",
  "profile.support.systemStatus": "Dienststatus",
  "profile.support.operational": "Betriebsbereit",
  "profile.support.degraded": "Beeinträchtigt",
  "profile.support.uptime": "Uptime"
};

const dictionaries: Record<Locale, Dictionary> = {
  ru,
  en,
  de
};

function isLocale(input: string | null): input is Locale {
  return input === "ru" || input === "en" || input === "de";
}

function resolveLocale(input: string | undefined): Locale {
  const normalized = input?.toLowerCase() ?? "";
  if (normalized.startsWith("ru")) {
    return "ru";
  }
  if (normalized.startsWith("de")) {
    return "de";
  }
  return "en";
}

const I18nContext = createContext<I18nContextValue>({
  locale: "en",
  setLocale: () => undefined,
  t: (key) => key
});

export function I18nProvider({ children }: PropsWithChildren) {
  const { languageCode } = useTelegram();

  const [locale, setLocaleState] = useState<Locale>(() => {
    const stored = typeof window !== "undefined" ? window.localStorage.getItem(LOCALE_STORAGE_KEY) : null;
    if (isLocale(stored)) {
      return stored;
    }

    const source = languageCode ?? (typeof navigator !== "undefined" ? navigator.language : "en");
    return resolveLocale(source);
  });

  const setLocale = useCallback((next: Locale) => {
    setLocaleState(next);
    if (typeof window !== "undefined") {
      window.localStorage.setItem(LOCALE_STORAGE_KEY, next);
    }
  }, []);

  const value = useMemo<I18nContextValue>(
    () => ({
      locale,
      setLocale,
      t: (key: string) => dictionaries[locale][key] ?? dictionaries.en[key] ?? key
    }),
    [locale, setLocale]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
